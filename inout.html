<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë¬´ë“±ì‚°êµ­ë¦½ê³µì› ì•ˆì „ì‚°í–‰ Check IN/OUT</title>
<style>
  body { 
    font-family: Arial, sans-serif; 
    padding: 20px; 
    max-width: 480px; 
    margin: auto; 
    text-align: center; /* ë‚´ìš© ê°€ìš´ë° ì •ë ¬ */
  }

  input, button { 
    padding: 12px; 
    margin: 5px 0; 
    width: 100%;       /* ë²„íŠ¼ê³¼ ë™ì¼í•œ ë„ˆë¹„ */
    font-size: 16px; 
    box-sizing: border-box; /* íŒ¨ë”© í¬í•¨ ë„ˆë¹„ ê³„ì‚° */
    border-radius: 8px; 
    border: pointer; 
    cursor: pointer; 
  }

  input { 
    text-align: center;  /* ì…ë ¥ ë‚´ìš© ê°€ìš´ë° ì •ë ¬ */
    margin-bottom: 10px;
  }

  button.start { background-color: #007BFF; color: white; }
  button.mid { background-color: #FFC107; color: black; }
  button.end { background-color: #28A745; color: white; }

  .log { margin-top: 20px; font-size: 14px; word-break: break-word; text-align: left; }
  .alert { color: red; font-weight: bold; margin-bottom: 10px; }
  #message { margin-top: 10px; font-weight: bold; font-size: 18px; }

  .guide {
    text-align: left; /* ì™¼ìª½ ì •ë ¬ */
    padding: 10px;    /* ì›í•˜ë©´ ì—¬ë°± ì¶”ê°€ */
}
  
</style>
</head>
<body>

<h2>ë¬´ë“±ì‚°êµ­ë¦½ê³µì› ì•ˆì „ì‚°í–‰ Check IN/OUT</h2>

<label>ì „í™”ë²ˆí˜¸:</label>
<input type="text" id="phone" placeholder="010-1234-5678" inputmode="tel">

<button class="start" onclick="checkIn('start')">êµ­ë¦½ê³µì› ì…êµ¬ ì²´í¬ì¸</button>
<button class="mid" onclick="checkIn('mid')">ì‚°í–‰ ì¤‘ ì²´í¬</button>
<button class="end" onclick="checkIn('end')">êµ­ë¦½ê³µì› ì¶œêµ¬ ì²´í¬ì•„ì›ƒ</button>

<br>
<br>
  
<div class="guide">
ğŸŸ¢ ë‚´ ì „í™”ë²ˆí˜¸ ì…ë ¥<br>
ğŸŸ¢ ì…êµ¬/ì‚°í–‰ í´ë¦­<br>    
ğŸŸ¢ ì¶œêµ¬ í´ë¦­<br>
</div>  
  
<div id="message"></div>
<div class="log" id="log"></div>

<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwjufnBNZtPhucvyQ4BMImls7fR064bkuGPY5UQjpnPVtNW7Z9GU5BhTBDQnu94QnUo/exec'; // Web App URL ì…ë ¥

let startTime, midTime, endTime;

function getLocation(callback) {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition((position) => {
            callback({ lat: position.coords.latitude, lng: position.coords.longitude });
        }, () => { alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); });
    } else {
        alert("GPSë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê¸°ê¸°ì…ë‹ˆë‹¤.");
    }
}

function checkIn(type) {
    const phone = document.getElementById('phone').value;
    if (!phone) { alert("ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

    getLocation((coords) => {
        const now = new Date();
        const record = {
            phone: phone,
            type: type,
            lat: coords.lat,
            lng: coords.lng,
            timestamp: now.toISOString(),
            mapLink: `https://map.kakao.com/link/map/${coords.lat},${coords.lng}` // ì¹´ì¹´ì˜¤ ì§€ë„ ë§í¬
        };

        if (type === 'start') startTime = now;
        if (type === 'mid') midTime = now;
        if (type === 'end') {
            endTime = now;
            record.duration = ((endTime - startTime)/1000/60).toFixed(1) + "ë¶„";
        }

        // êµ¬ê¸€ì‹œíŠ¸ ìë™ ê¸°ë¡
        fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(record)
        }).then(() => {
            let logText = `${type} ì²´í¬ ì™„ë£Œ: ${record.lat}, ${record.lng} - <a href="${record.mapLink}" target="_blank">ì§€ë„ë³´ê¸°</a>`;
            if (record.duration) logText += `, ì´ ì‚°í–‰ ì‹œê°„: ${record.duration}`;
            document.getElementById('log').innerHTML += `<p>${logText}</p>`;

            const msgDiv = document.getElementById('message');
            if (type === 'start') msgDiv.style.color = '#007BFF';
            else if (type === 'mid') msgDiv.style.color = '#FFC107';
            else if (type === 'end') msgDiv.style.color = '#28A745';

            msgDiv.textContent = "ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤";
            setTimeout(() => { msgDiv.textContent = ""; }, 3000);
        });
    });
}

// í‡´ì‹¤ ë¯¸ì²´í¬ ê²½ê³  (24ì‹œê°„)
setInterval(() => {
    if (startTime && !endTime) {
        const now = new Date();
        if ((now - startTime)/1000/60/60 > 24 && !document.getElementById('alert')) {
            const alertDiv = document.createElement('div');
            alertDiv.id = 'alert';
            alertDiv.className = 'alert';
            alertDiv.textContent = 'âš ï¸ í‡´ì‹¤ ì‹œê°„ì´ ì§€ë‚¬ìŠµë‹ˆë‹¤. í™•ì¸ í•„ìš”!';
            document.body.prepend(alertDiv);
        }
    }
}, 60000);
</script>

</body>
</html>
