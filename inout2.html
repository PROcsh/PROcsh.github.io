<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ë¬´ë“±ì‚°êµ­ë¦½ê³µì› ìŠ¤ë§ˆíŠ¸ì•ˆì‹¬ ì‚°í–‰</title>

<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  max-width: 480px;
  margin: auto;
  padding: 16px;
  background: #f4f6f8;
}

h2 {
  margin-bottom: 16px;
}

input {
  width: 90%;
  padding: 14px;
  font-size: 18px;
  border-radius: 10px;
  border: 1px solid #ccc;
  margin-bottom: 12px;
}

button {
  width: 100%;
  padding: 16px;
  font-size: 18px;
  border-radius: 12px;
  border: none;
  margin: 8px 0;
  font-weight: bold;
}

button.start { background: #007bff; color: white; }
button.mid   { background: #ffc107; }
button.end   { background: #28a745; color: white; }

button:active {
  transform: scale(0.98);
}

#message {
  margin-top: 14px;
  font-size: 17px;
  font-weight: bold;
}

.notice {
  font-size: 14px;
  color: #555;
  margin-top: 12px;
}
</style>
</head>
<body>

<h2>ğŸŸ¢ ë¬´ë“±ì‚°êµ­ë¦½ê³µì› ìŠ¤ë§ˆíŠ¸ì•ˆì‹¬ ì‚°í–‰</h2>

<input
  id="phone"
  type="tel"
  inputmode="numeric"
  placeholder="ì „í™”ë²ˆí˜¸ (ìˆ«ìë§Œ)"
>

<button class="start" onclick="send('start')">êµ­ë¦½ê³µì› ì…êµ¬ ì²´í¬ì¸</button>
<button class="mid" onclick="send('mid')">ì‚°í–‰ ì¤‘</button>
<button class="end" onclick="send('end')">í•˜ì‚°ì™„ë£Œ ì²´í¬ì•„ì›ƒ</button>

<div id="message"></div>

<div class="notice">
ğŸ“ ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì•¼ ì •ìƒ ì „ì†¡ë©ë‹ˆë‹¤.<br>
ğŸ“¶ í†µì‹  ë¶ˆì•ˆ ì‹œ ì „ì†¡ì´ ì§€ì—°ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
</div>

<script>
const SCRIPT_URL =
  "https://script.google.com/macros/s/AKfycbwWDFctYxqQlETrA3SDVeM9wYGWb0WDX7nfHnJKaQdwZT_pk8p_kLN8sAVN3uUhwDyq/exec";

let startTime = null;

function send(type) {
  const phone = document.getElementById('phone').value.trim();
  if (!phone) {
    alert("ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”");
    return;
  }

  document.getElementById('message').textContent = "ğŸ“¡ ìœ„ì¹˜ í™•ì¸ ì¤‘â€¦";

  navigator.geolocation.getCurrentPosition(
    pos => {
      const now = new Date();
      if (type === 'start') startTime = now;

      const data = {
        phone,
        type,
        lat: pos.coords.latitude,
        lng: pos.coords.longitude,
        timestamp: now.toISOString(),
        mapLink: `https://map.kakao.com/link/map/${pos.coords.latitude},${pos.coords.longitude}`,
        duration:
          type === 'end' && startTime
            ? ((now - startTime) / 60000).toFixed(1) + "ë¶„"
            : ""
      };

      fetch(SCRIPT_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      document.getElementById('message').textContent = "âœ… ì „ì†¡ ì™„ë£Œ";
      setTimeout(() => {
        document.getElementById('message').textContent = "";
      }, 2000);
    },
    err => {
      alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nGPSë¥¼ ì¼œì£¼ì„¸ìš”.");
      document.getElementById('message').textContent = "";
    },
    {
      enableHighAccuracy: true,
      timeout: 10000,
      maximumAge: 0
    }
  );
}
</script>

</body>
</html>
